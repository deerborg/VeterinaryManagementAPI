<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>Müşteri Listesi</title>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f4f4f4;
            background-image: url('https://wallsneedlove.com/cdn/shop/products/w0596_1s_Blue-and-coral-bohemian-eclectic-tiger-wallpaper-Feline-Fatale_Repeating-Pattern-Sample-1b.jpg?v=1635528454');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .card {
            width: 400px;
            background-color: rgba(255, 255, 255, 0.99);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            animation: slideOpacity 3s infinite alternate;
        }

        @keyframes slideOpacity {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0.90;
                transform: translateY(10px);
            }
        }

        h1 {
            color: #007BFF;
            margin-bottom: 20px;
        }

        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        li {
            background-color: rgba(255, 255, 255, 0.99);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .button-container {
            display: flex;
            justify-content: center;
        }

        button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button.delete {
            background-color: #dc3545;
            color: #fff;
        }

        button.update {
            background-color: #007bff;
            color: #fff;
        }

        #error-message {
            display: none;
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            color: white;
        }

        .update-form {
            display: none;
            flex-direction: column;
            padding-top: 20px; /* Arayüzü yukarı doğru genişletmek için */
            border-top: 1px solid #ddd; /* Arayüzü yukarı doğru genişletmek için */
        }

        .update-form label {
            margin: 5px 0;
            text-align: left;
            width: 100%;
            font-weight: bold;
        }

        .update-form input,
        .update-form select {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: calc(100% - 22px);
        }

        .update-form button {
            width: 100%;
        }
        .go-back {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .go-back:hover {
            background-color: #0056b3;
        }
        .footer {
            width: 100%;
            height: 50px;
            opacity: 0.9;
            background-color: orange;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            bottom: 0;
            left: 0;
            padding: 10px 0;
        }
        .social-icons {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
        }
        .social-icons a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
            font-size: 24px;
            transition: color 0.3s ease;
        }
        .social-icons a:hover {
            color: cornflowerblue;
        }
        .footer p {
            margin: 0;
            font-size: 14px;
            font-weight: 500;
        }

    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>Customer List</h1>
        <div id="error-message"></div>
        <div id="customerList">
            <ul>
                <!-- JavaScript ile oluşturulacak müşteri listesi buraya gelecek -->
            </ul>
        </div>
        <button class="go-back" onclick="goBackMain()">Go Back Main</button>
    </div>

</div>
<div class="footer">
    <div class="social-icons">
        <a href="https://github.com/deerborg" target="_blank"><i class="fab fa-github"></i></a>
        <a href="https://www.linkedin.com/in/ffurkanaydemir/" target="_blank"><i class="fab fa-linkedin"></i></a>
        <a href="https://www.behance.net/deeborgh" target="_blank"><i class="fab fa-behance"></i></a>
    </div>
    <p>deerborg</p>
</div>
<script>
    function goBackMain() {
        window.location.href = "/welcome";
    }
    fetch('/v1/customers/all-customer')
        .then(response => response.json())
        .then(data => {
            if (data.status === true) {
                const customers = data.data;
                const htmlContent = customers.map(customer => {
                    return `<li id="customer-${customer.id}">
                            <span id="customer-name-${customer.id}">${customer.name}</span>
                            <div class="button-container">
                                <button class="delete" data-id="${customer.id}" data-name="${customer.name}">Delete</button>
                                <button class="update" data-id="${customer.id}" data-name="${customer.name}" data-phone="${customer.phone}" data-mail="${customer.mail}" data-city="${customer.city}">Update</button>
                            </div>
                            <div class="update-form" id="update-form-${customer.id}" style="display: none;">
                                <label for="update-name-${customer.id}">Name:</label>
                                <input type="text" id="update-name-${customer.id}" placeholder="Name" value="${customer.name}">

                                <label for="update-phone-${customer.id}">Phone:</label>
                                <input type="text" id="update-phone-${customer.id}" placeholder="Phone" value="${customer.phone}">

                                <label for="update-mail-${customer.id}">Mail:</label>
                                <input type="text" id="update-mail-${customer.id}" placeholder="Mail" value="${customer.mail}">

                                <label for="update-city-${customer.id}">City:</label>
                                <select id="update-city-${customer.id}">
                                    <option value="Adana" ${customer.city === 'Adana' ? 'selected' : ''}>Adana</option>
                                    <option value="Ankara" ${customer.city === 'Ankara' ? 'selected' : ''}>Ankara</option>
                                    <option value="İstanbul" ${customer.city === 'İstanbul' ? 'selected' : ''}>İstanbul</option>
                                    <!-- Diğer şehir seçenekleri -->
                                </select>

                                <button class="save-update" data-id="${customer.id}">Save</button>
                            </div>
                        </li>`;
                }).join("");
                document.getElementById("customerList").innerHTML = "<ul>" + htmlContent + "</ul>";

                const deleteButtons = document.querySelectorAll(".delete");
                deleteButtons.forEach(button => {
                    button.addEventListener("click", function() {
                        const customerId = this.getAttribute("data-id");
                        const customerName = this.getAttribute("data-name");
                        // Silme isteği gönderme
                        fetch(`/v1/customers/name/${customerName}`, {
                            method: 'DELETE'
                        })
                            .then(response => response.json())
                            .then(data => {
                                document.getElementById('error-message').innerText = data.message;
                                document.getElementById('error-message').style.backgroundColor = '#28a745'; // Yeşil arka plan başarılı işlem için
                                document.getElementById('error-message').style.display = 'block';

                                // 2 saniye bekleyip sayfayı yenileme
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000);

                                if (data.status === true) {
                                    console.log("Müşteri ID'si: ", customerId, " başarıyla silindi.");
                                    // Silinen müşteriyi listeden kaldırma
                                    document.getElementById(`customer-${customerId}`).remove(); // Müşteriyi listeden kaldırır
                                } else {
                                    console.error("Silme işlemi başarısız oldu: " + data.message);
                                }
                            })
                            .catch(error => console.error("Hata oluştu:", error));
                    });
                });

                const updateButtons = document.querySelectorAll(".update");
                updateButtons.forEach(button => {
                    button.addEventListener("click", function() {
                        const customerId = this.getAttribute("data-id");
                        const updateForm = document.getElementById(`update-form-${customerId}`);
                        updateForm.style.display = 'block';

                        // "Cancel" butonunu oluştur
                        const cancelButton = document.createElement("button");
                        cancelButton.innerText = "Cancel";
                        cancelButton.classList.add("cancel-update");
                        cancelButton.setAttribute("data-id", customerId);
                        cancelButton.style.marginTop = "10px"; // Butonun üstündeki boşluğu ayarla
                        updateForm.appendChild(cancelButton);

                        // "Cancel" butonuna tıklanınca formu kapat
                        cancelButton.addEventListener("click", function() {
                            updateForm.style.display = 'none';
                            this.remove(); // "Cancel" butonunu kaldır
                            // "Update" butonunu tekrar etkinleştir
                            button.disabled = false;
                        });

                        // "Update" butonunu devre dışı bırak
                        button.disabled = true;
                    });
                });
                // CustomerAllResponse kısmında hassas verileri silip, service kısmında verileri ekleyebilirsiniz.
                // Sonrasında JSON olarak hassas verileri kaldırın
                const saveUpdateButtons = document.querySelectorAll(".save-update");
                saveUpdateButtons.forEach(button => {
                    button.addEventListener("click", function() {
                        const customerId = this.getAttribute("data-id");
                        const updatedName = document.getElementById(`update-name-${customerId}`).value;
                        const updatedPhone = document.getElementById(`update-phone-${customerId}`).value;
                        const updatedMail = document.getElementById(`update-mail-${customerId}`).value;
                        const updatedCity = document.getElementById(`update-city-${customerId}`).value;

                        fetch(`/v1/customers`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                id : customerId,
                                name: updatedName,
                                phone: updatedPhone,
                                mail: updatedMail,
                                city: updatedCity,
                                address: "Turkey"
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                document.getElementById('error-message').innerText = data.message;
                                document.getElementById('error-message').style.backgroundColor = '#28a745'; // Yeşil arka plan başarılı işlem için
                                document.getElementById('error-message').style.display = 'block';

                                // 2 saniye bekleyip sayfayı yenileme
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000);

                                if (data.status === true) {
                                    console.log("Müşteri ID'si: ", customerId, " başarıyla güncellendi.");
                                    // Güncellenen verileri formdan alıp listeye yansıtma
                                    const customerElement = document.getElementById(`customer-name-${customerId}`);
                                    customerElement.innerText = updatedName;
                                    document.getElementById(`update-form-${customerId}`).style.display = 'none'; // Formu gizle
                                } else {
                                    console.error("Güncelleme işlemi başarısız oldu: " + data.message);
                                }
                            })
                            .catch(error => console.error("Hata oluştu:", error));
                    });
                });
            } else {
                console.error("İstek başarısız oldu: " + data.message);
            }
        })
        .catch(error => console.error("Hata oluştu:", error));
</script>
</body>
</html>